Communication and Network Securtiy 


Chapter 11: Secure Network Architecture and components 
Chapter 12: 

Chapter 11

What is a protocol? Set of rules that define communication and how data is transmitted over a medium
What is OSI model?
It is an abstract or theoretical model that establishes a communication standard for all computer systems.
What are the layer of the OSI model? Application, persentation, session, transport, network,data link, physical 
Explain the encapsulation and deencapsulation process
Encapsulation is addirtion of header and footers to tehe data received from the top layer( application to physical)
Deencapsulation : The stripping away of the headers and footers form the data untir (from physical to application) 


Explain: Application layer receives data from the SW, It encapsulates this data by adding a header.This contrinues until the 
physcial layer. The phsysical layer converts the meaasge into a stream of bits 0 and 1s for transmission over the physical medium.
The receiving computer captures the bits from the physical medium and restructures the message. 
It sends this to data link layer...and up the layers - This is the deencapsulation process,.When it reaches the app layer, it is sent to the intended SW recepient 

PDU : Protocol Data unit - the data sent across the layers
Transport layer - segnent 
Network layer - Packet 
DL layer - Frame 
Physcoal - Bits 

Application layer 
The interface between the SW and the Stack. The SW application is not located here..we have the protocols and services required to interface 
with the application.

Presntation layer 
Responsible for encyption and decryption

Where can encryption occurr in network communication? 
1. Pre network encryption - where the SW encrpts prior to sending the data to the application layer 
2. Transport layer encryption - performed by TLS 
VPN encryption- Occurs at layer 2, layer 3 and 4 , depending on the VPN technology in use. L2TP, IPSEC, openVPN
3. Wireless encryption and the data link layer 
4. Bulk encryption and the physical layer (Occurs at the NIC)


Session layer 
Established, maintains and terminates the sessions betworrn 2 computers- Simplex, half duplex, full duplex 
Simplex - one way communication 
Half dublex - 2 way communication, one at a time, \
Full duplex - 2 way communication, simultaneous sending 

Transport Layer 
Manages integrity of connection 
Controls the session. This layer establishes the rules of communication. e.g how much data can each segment contain, how to verify the message integrity
How to determine whether data has been lost. Session rules are implemented through the handshake process
Segmantation, sequencing, error checking, adat flow, error correction, multiplexing 

Protocols: TCP, UDP, TLS 

Network layer
responsible for logocal addressing and routing 
Source and destination ip addresses added to the segment
Routers operate at this layer - Routers determine the bets path for a packet based on speed, hops, preference e.t.c 

Routing protocols - IGPs and ERPS 
IGPs are myopic while ERPs are far sighted 

IGP: DV and LS 
DV - Number of hops to detrmine the best path...RIP, IGRP
LS - router characteristivs to determine the best path. - Jitter, latency, error rate e.t.c - OSPF, IS-IS, EIGRP 

ERPs - Path Vector - BGP 

Data Link Protocol
IEEE 802.3
Adding source and destination hardware addresses. (Mac addresses)
Mac address: 48 bits - 24 bits (OIU), 24 bits(manufacturer)
Protocols : ARP , RARP, Ethernet 
Devices that function here are switches 

physical layer 
Converts frames into bits and transmits over the physcial medium. 
Devices that function at Layer 1: NICs, Hubs, repeaters, concentrators and amplifiers 

TCP/IP Model 
Also called the Darpa or DOD
Consuits of 4 layers : Applicatipon, Transport, Internet, Network access 

Some of the TCP/IP vulnerabilities 
:Buffer overflow , SYN flood attacks, DOS attacks, Fragment attacks, Oversized packet attacks, Spoofing attacks, man in the middle 
hijack attacks, coding error attacks . 


A protocol analyser is used to examine the content of network traffic. Also called sniffer, network evaluator, network analyser or packet capturing utility 
Can be a dedicated SW of HW device
Captures the frame or packet and uses complex tools to analyse. 
It places the NIC into promiscous mode to see and capture all the ethernet frames on the LAN. In this mode, the NIC ignotes the dectination address of the frames and collects all the frames that reach the interface
Exampines to the binary level
The payload is displayed in hexa or ASCII 
Protocol analysers offer capture filter and display filter
Capture filter: Decides which frames are captured and saved. 
Dispay filter: Show only frames from  the packet file that match your requirements 

Exmaples - Wireshark (Opne source) , Onmipeek, netwitness(commercial) 

Application layer Protocols 

|protocol  |  port          |     function 
--------------------------------------------
|Telnet    |    23          |  Terminal Emulation network application - remote connectivity between hosts for communication - USE SSH  instead
|FTP       |    20/21       |  File Transfer Protocol - Exchange of files that requires authentication - Should FTPS instead
|TFTP      |    UDP 69      |  Trivial File transfer - Does not require authentication - Can host netwoek device config files - Should not be used
|SMTP      |    25          |  Sends email messages from client to server and between email servers - Only use if encrypted with TLS to crearte SMTPS
|POP3      |    110         |  Post Office protocol- Used to pull emails from inbox in the email server to email client(client archiving) - Use if enctrpted with TLS to create POPS
|IMAP4     |    143         |  Intrnet Message Access Protocol - Used to pull emails from inbox in the email server to email client(client archiving)Has ability to retrieve only headers from the email server and delete messages directly on the server
|DHCP      |    UDP 67/68   |  Dynamic Host Control Protocol - Centralised control of TCP/IP configs 
|HTTP      |    80          |  HyperText Transfer protocol - Transmits web pages from web server to web browser in clear text 
|HTTPS     |    443         |  HyperTect Transfer Protocol - Transmits web pages from web server to web browser securely - TLS encrypted version of HTTP
|LDP       |    515         |  Used to send pribt jobs to a printer
|NFS       |    2049        |  Supports file sharing across dissimilar systems
|SNMP      |    UDP 161/162 |  Collects network helath and status information from a central monitoring station. 


Transport layer protocols 
Connections are established using ports 
Ports are 16 digit binary numbers 
The total number of ports are 2^16 = 65536 
Ports are numbered 0 to 65,535
Socket: Combination of a port and IP 
0-1023 - well known ports or service ports - to be used by servers
1024 - 49151 - registered software ports - For IANA registered softwares 
49,152 - 65,535 - Random or dynamic ports used randomly by clients as source ports 

Protocols at transport layer : TCP and UDP 
TCP : Transmission Control Protocol - Full duplex connection oriented protocol , because of three way handshake 
UDP : User Datagram protocol - Simplex conectionless protocol - Best effort - low overhead, fast data transmission- Audio and video communications 

Three way handshake 

SYN - Syncronise sent form client to server 
SYN ACK - From Server to client - Syncronised and acknowledged
ACK - Client to server 

How do you disconnect a communication session when it is complete? 
1. FIN (finish)
2. RST (reset) 

Domain Name System 
What is DNS? Resolves human friendly domain name to an IP address 
Then ARP which resolves the IP address into the MAC address
DNS reverse kookup: resolves the IP address into the domain name

DNS is hierachical naming system 
DNS links IP addresses and human friendly FQDN 
FQDN consists of 
1. Top level Domain (TLD) - .com
2. Registered domain name: 
3. Subdomain 

Maximum length of FQDN - 253 characters 

The process of DNS 
Historically, the mapping used to be stored on a hosts file. However, this caused a security concern as hackers would be able to alter this file. 
When client software points to an FQDN, the resolver first checks the local DNS cache
Local DNS cache has the local hosts files and alny query results that havent timed out. 
If not in the DNS cache, the request is forwarded to the DNS server

DNS runs on TCP and UDP 53 
TCP 53 - zone transfers 
UDP 53 - for typical requests 

DNSSEC - provides mutual cert authentication and encrypted sessions between devices during DNS operations.. Applies to DNS servers only.

Non-DNS servers should use DoH. This creates an encrypted session with a DNS server of TLS protected HTTP and uses that session as a form of VPN to protect the DNS query and response
In 2020, we had, the ODOH (oblivious DNS over HTTPs) - this adds a DNS proxy between the client and DNS resolver so that the identity of requesting client is isolated from the DNS reslover. 
This provides anonymity and privacy to DNS queries.


DNS Poisoning 
The process of falsifying the DNS information used by client to reach a destination.

1. Rogue DNS server - The client sends a request to the DNS server. A rogue DNS server listens to the network traffic and responds to the client with falsified information.
Once client received the false information, the DNS quesry session is closed and hence the response form the reasl server id dropped and ignored. 

2. DNS Cache Poisoning 
This is a direct attack on the DNS servers by altering the primary record. There are 2 ways adverseries achieve this 
    - Attacking the authoritative DNS servers - this are the primary servers. Easily monitored by community hence not impactful on clients 
    - Attacking the DNS caching servers - These cache information from other DNS servers and might take long to be discoverd. 

3. DNS pharming 
Melicious redirection of valid websites URL or IP addresses to a fake website. Can be achieved by modifying the Local hosts file or poisonong or spoofing DNS resolution. 

4. Host file alteration 
An attacker plants false information into the hosts file. This affects specific clients 

5. DNS query spoofing 
Attacker intercepty the DNS session and eavedroping on the query. Attacker sends back a reply with false info. 

6. Use proxy falsification 

Defenses against DNS poisoning 

1. Limit zone transfers from internal DNS servers to external DNS servers - Blocking inbound TCP and UDP 53 
2. Require resolution through internal DNS. This requires blocking outbound UDP port 53 while keeping outbound TCP 53 open. 
3. Limit external DNS servers form which internal DNS servers pull zone transfers 
4. deploy Network IDS(NIDS) and Host IDS (HIDS) to monitor abnormal DNS traffic 
5. Harden DNS, servers, clients 
6. Use DNSSEC to secure DNS infra
7. Use DoH or ODOH 

Another - orgs can use split DNS 

What is Split DNS?
2 DNs servers - One public, one internal 
For the public, all data in the zone file should be accessible by the public via probing or querying 
For the internal DNS - this is only accessible to the internal systems 
ousiders cannot access the internal DNs as TCP and UDP 53 inbound is blocked 
Internal systems can be configured to only interact with the internal DNS server or send quesries to an external DNS server(for which a FDW in stateful 
mode is configured to allow the responses from approved outbound queries. 

Another  DNS Sinkhole
These provide false responses for DNS queries from Malware e.g bots so as to prevent access to cnc . It also protects users from visitinh lknown malicious websites .





